# Manual YML Generation for macOS Auto-Updates

Since `electron-forge` doesn't automatically generate the YML metadata files required by `electron-updater` for macOS auto-updates, we've created custom scripts to handle this process.

## Overview

The auto-update system requires specific YML files to be present in your GitHub releases:
- **Windows**: `latest.yml` (automatically generated by `@electron-forge/maker-squirrel`)
- **macOS**: `latest-mac.yml` (must be generated manually)

## Scripts

### 1. `scripts/generate-yml.js`
Generates the required YML metadata files for electron-updater.

**What it does:**
- Scans the `out/make` directory for built applications
- Calculates SHA512 hashes and file sizes
- Generates YML files with proper GitHub release URLs
- Creates `latest-mac.yml` for macOS auto-updates

### 2. `scripts/upload-yml.js`
Uploads the generated YML files to your GitHub release.

**Requirements:**
- GitHub CLI (`gh`) must be installed
- Must be authenticated with GitHub (`gh auth login`)

## Usage

### Option 1: Manual Step-by-Step
```bash
# 1. Build your application
npm run build

# 2. Make distributions for all platforms
npm run make:all

# 3. Publish to GitHub (creates release and uploads assets)
npm run publish

# 4. Generate YML metadata files
npm run generate-yml

# 5. Upload YML files to the release
npm run upload-yml
```

### Option 2: Automated Release Process
```bash
# Run the complete release process (includes YML generation and upload)
npm run release
```

## Manual YML Upload (Alternative)

If you prefer to upload manually or don't have GitHub CLI installed:

1. After running `npm run generate-yml`, the YML files will be in `out/make/`
2. Go to your GitHub release page
3. Edit the release
4. Upload the `latest-mac.yml` file as a release asset
5. Save the release

## YML File Format

The generated `latest-mac.yml` looks like this:

```yaml
version: 1.1.0
files:
  - url: https://github.com/lvcabral/carabiner/releases/download/v1.1.0/Carabiner-darwin-arm64-1.1.0.zip
    sha512: HLYTaN3rBo2lZY7lDAaS3PMyZxdTUhwvCLdF08umIEwPbuMbvVmAY4txLytDWkK4IyF3pWhxRa0EeD9ijo6nbg==
    size: 169666023
path: Carabiner-darwin-arm64-1.1.0.zip
sha512: HLYTaN3rBo2lZY7lDAaS3PMyZxdTUhwvCLdF08umIEwPbuMbvVmAY4txLytDWkK4IyF3pWhxRa0EeD9ijo6nbg==
releaseDate: 2025-07-05T15:12:48.472Z
```

## Troubleshooting

### Problem: "No ZIP file found for version"
**Solution:** Make sure you've run `npm run make:mac` or `npm run make:all` first.

### Problem: GitHub CLI not found
**Solution:** Install GitHub CLI:
```bash
# macOS
brew install gh

# Or download from https://cli.github.com/
```

### Problem: YML files not being found by electron-updater
**Checklist:**
1. Ensure YML files are uploaded to the GitHub release
2. Verify the URLs in the YML files point to the correct release assets
3. Check that the release is published (not draft)
4. Confirm the app is checking the correct repository for updates

### Problem: Auto-update fails with "Update not available"
**Possible causes:**
1. YML files missing from release
2. Version in YML doesn't match the release tag
3. App version is not lower than the release version
4. Network/firewall blocking GitHub access

## Verification

To verify everything is working:

1. Check your GitHub release has all required files:
   - Application files (DMG, ZIP, EXE, etc.)
   - `latest-mac.yml`
   - `latest.yml` (Windows)

2. Test auto-update on a device with an older version of your app

3. Check the console logs in your app for updater messages

## Notes

- The scripts automatically handle version detection from `package.json`
- SHA512 hashes are calculated for security verification
- File sizes are included for download progress tracking
- Release dates are set to the current timestamp when YML is generated

For more information about electron-updater, see: https://www.electron.build/auto-update
